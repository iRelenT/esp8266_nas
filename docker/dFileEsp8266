FROM ubuntu:latest

#---------prebuild toolchain
#setting workdir to root
WORKDIR /

RUN apt-get update && apt-get install -y software-properties-common
RUN apt update && add-apt-repository universe
RUN apt-get -y install gcc wget git make libncurses-dev flex bison gperf python3 python3-serial python3-pip
RUN mkdir -p downloads esp8266
ADD https://dl.espressif.com/dl/xtensa-lx106-elf-gcc8_4_0-esp-2020r3-linux-amd64.tar.gz downloads
RUN cd esp8266;tar -xzf /downloads/xtensa-lx106-elf-gcc8_4_0-esp-2020r3-linux-amd64.tar.gz;

#The toolchain will be extracted into ~/esp/xtensa-lx106-elf/ directory.
#To use it, you will need to update your PATH environment variable in ~/.profile file. To make xtensa-lx106-elf #available for all terminal sessions, add the following line to your ~/.profile
ENV PATH=/esp8266/xtensa-lx106-elf/bin:$PATH
#-----------------------------------------------------
#--------downloading ESP8266_RTOS_SDK (contains scripts to use toolchain and the API to control microcontroller)
RUN mkdir -p projects;cd esp8266;git clone https://github.com/espressif/ESP8266_RTOS_SDK.git;
##also add tools/idf.py
ENV IDF_PATH="/esp8266/ESP8266_RTOS_SDK" 
RUN ln -s /usr/bin/python3 /usr/bin/python
ENV TERM xterm
RUN python3 -m pip install --user -r $IDF_PATH/requirements.txt







